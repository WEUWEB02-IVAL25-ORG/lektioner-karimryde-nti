<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moonlander</title>
    <style>
        body {
            background: #272727;
        }

        canvas {
            background: #000;
            width: 700px;
            margin: auto;
            display: block;
        }
    </style>
</head>
<body>
    <canvas width="700" height="700"></canvas>
    <script>
        const c = document.querySelector('canvas')
        const ctx = c.getContext('2d')

        // Startvariabler
        let x = 350
        let y = 0
        let h = 700
        let fuel = 100

        // Hastighet
        let dy = 1

        // Månens gravitation
        let gravitation = 0.01

        // Variabel som håller koll på motorn
        let engineOn = false

        // Variabel för strymotorer
        let sideRight = false
        let sideLeft = false

        // Ladda ikonen
        const lander = new Image()
        lander.src = "./moon-landing.png"

        // Lyssna på spelarens input
        inputSpelare()

        // Animationsloopen
        function gameLoop() {
            // Rensa canvas
            ctx.clearRect(0, 0, 700, 700)

            // När vi träffar månytan
            if (h > 0) {
                // Ändring i fallhastighet
                dy += gravitation

                // Ändring i position ned till månytan = 680
                y += dy
                h = 620 - y

                // Om motorn är på
                if (engineOn && fuel > 0) {
                    dy -= 0.1
                    fuel -= 1
                    ritaRaketlåga()
                }

                // Om styrmotor höger är på
                if (sideRight && fuel > 0) {
                    x += 0.5
                    ritaHögerLåga()
                }
                // Om styrmotor vänster är på
                if (sideLeft && fuel > 0) {
                    x -= 0.5
                    ritaVänsterLåga()
                }
            } else {
                dy = 0
                h = 0
            }

            ritaHUD()
            ritaMånyta()
            ritaMånlandare()

            // Upprepa
            requestAnimationFrame(gameLoop)
        }
        gameLoop()

         // Lyssna på tangenten mellanslag (space)
        function inputSpelare() {
            window.addEventListener('keydown', function (e) {
                if (e.code == 'Space') {
                    engineOn = true
                }
            })
            window.addEventListener('keyup', function (e) {
                if (e.code == 'Space') {
                    engineOn = false
                }
            })
            window.addEventListener('keydown', function (e) {
                if (e.code == 'KeyD') {
                    sideRight = true
                }
            })
            window.addEventListener('keyup', function (e) {
                if (e.code == 'KeyD') {
                    sideRight = false
                }
            })
            window.addEventListener('keydown', function (e) {
                if (e.code == 'KeyA') {
                    sideLeft = true
                }
            })
            window.addEventListener('keyup', function (e) {
                if (e.code == 'KeyA') {
                    sideLeft = false
                }
            })
        }

        // Rita ut instrumentpanel (HUD)
        function ritaHUD() {
            ctx.fillStyle = "#fff"
            ctx.font = "20px Monospace"
            ctx.fillText("Hastighet: " + dy.toFixed(2), 10, 30)
            ctx.fillText("Höjd: " + h.toFixed(0), 10, 50)
            ctx.fillText("Bränsle: " + fuel.toFixed(0), 10, 70)
        }

        // Rita ut raketlågan
        function ritaRaketlåga() {
            ctx.beginPath()
            ctx.moveTo(x + 28, y + 50)
            ctx.lineTo(x + 20, y + 70)
            ctx.lineTo(x + 32, y + 70 + Math.random() * 30)
            ctx.lineTo(x + 42, y + 70)
            ctx.lineTo(x + 36, y + 50)
            ctx.fillStyle = "orange"
            ctx.fill()
        }

        function ritaHögerLåga(params) {
            ctx.fillStyle = "orange"
            ctx.fillRect(x, y + 10, 10, 3)
        }
        function ritaVänsterLåga(params) {
            ctx.fillStyle = "orange"
            ctx.fillRect(x + 45, y + 10, 10, 3)
        }

        // Rita ut månytan
        function ritaMånyta() {
            ctx.fillStyle = "#444"
            ctx.fillRect(0, 680, 700, 20)
        }

        // Rita ut månlandaren
        function ritaMånlandare() {
            ctx.drawImage(lander, x, y)
        }
    </script>
</body>
</html>